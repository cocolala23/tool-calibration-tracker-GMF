<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manajemen Alat</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-left">
      <h2>Sistem Kalibrasi</h2>
    </div>
    <div class="navbar-right">
      <button onclick="logout()">ðŸ”’ Logout</button>
    </div>
  </nav>

  <!-- Konten Utama -->
  <main class="dashboard-content container">
    <h3>Manajemen Alat</h3>

    <div class="summary">
      <strong>Total Alat:</strong> <span id="totalAlat">0</span>
    </div>

    <!-- Form Tambah Alat -->
    <form id="alatForm">
      <label for="registration">Registration:</label>
      <input type="text" id="registration" required>

      <label for="description">Description:</label>
      <input type="text" id="description" required>

      <label for="model">Model:</label>
      <input type="text" id="model">

      <label for="pn">P/N:</label>
      <input type="text" id="pn">

      <label for="sn">S/N:</label>
      <input type="text" id="sn">

      <label for="unit">Unit:</label>
      <input type="text" id="unit">

      <label for="unitDesc">Unit Desc:</label>
      <input type="text" id="unitDesc">

      <label for="location">Location:</label>
      <input type="text" id="location">

      <label for="nextDue">Next Due:</label>
      <input type="date" id="nextDue" required>

      <button type="submit">Simpan</button>
    </form>

    <!-- Tabel Daftar Alat -->
    <table id="alatTable">
      <thead>
        <tr>
          <th>Registration</th>
          <th>Description</th>
          <th>Model</th>
          <th>P/N</th>
          <th>S/N</th>
          <th>Unit</th>
          <th>Unit Desc</th>
          <th>Location</th>
          <th>Next Due</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <!-- Script Logic -->
  <script>
    // Cek login
    if (!localStorage.getItem("isLoggedIn")) {
      window.location.href = "../index.html";
    }

    function logout() {
      localStorage.removeItem("isLoggedIn");
      localStorage.removeItem("loggedInUser");
      window.location.href = "../index.html";
    }

    const form = document.getElementById("alatForm");
    const tableBody = document.querySelector("#alatTable tbody");
    const totalAlatDisplay = document.getElementById("totalAlat");
    let alatList = JSON.parse(localStorage.getItem("alatList")) || [];

    function updateTotal() {
      totalAlatDisplay.textContent = alatList.length;
    }

    function tampilkanAlat() {
      tableBody.innerHTML = "";
      alatList.forEach((alat, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${alat.registration}</td>
          <td>${alat.description}</td>
          <td>${alat.model}</td>
          <td>${alat.pn}</td>
          <td>${alat.sn}</td>
          <td>${alat.unit}</td>
          <td>${alat.unitDesc}</td>
          <td>${alat.location}</td>
          <td>${alat.nextDue}</td>
          <td><button onclick="hapusAlat(${index})">Hapus</button></td>
        `;
        tableBody.appendChild(row);
      });
      updateTotal();
    }

    function hapusAlat(index) {
      if (confirm("Yakin ingin menghapus alat ini?")) {
        alatList.splice(index, 1);
        localStorage.setItem("alatList", JSON.stringify(alatList));
        tampilkanAlat();
      }
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const alat = {
        registration: document.getElementById("registration").value,
        description: document.getElementById("description").value,
        model: document.getElementById("model").value,
        pn: document.getElementById("pn").value,
        sn: document.getElementById("sn").value,
        unit: document.getElementById("unit").value,
        unitDesc: document.getElementById("unitDesc").value,
        location: document.getElementById("location").value,
        nextDue: document.getElementById("nextDue").value
      };
      alatList.push(alat);
      localStorage.setItem("alatList", JSON.stringify(alatList));
      tampilkanAlat();
      form.reset();
    });

    // Inisialisasi data saat halaman dimuat
    tampilkanAlat();
  </script>
</body>
</html>